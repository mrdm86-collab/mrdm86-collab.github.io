---
import Navbar from '../components/Navbar';
import '../styles/global.css';
import { ui } from '../i18n/ui';

interface Props {
  title: string;
  lang?: keyof typeof ui;
  isHome?: boolean;
}

const { title, lang = 'zh', isHome = false } = Astro.props;

// 辅助翻译函数，仅用于 Layout 内部（如 Footer）
function useTranslations(lang: keyof typeof ui) {
  return function t(key: keyof typeof ui['zh']) {
    return ui[lang][key] || ui['zh'][key];
  }
}
const t = useTranslations(lang as keyof typeof ui);
---

<!doctype html>
<html lang={lang} class={isHome ? "overflow-hidden" : "scroll-smooth"}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
    <script is:inline>
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  
  <body class={`flex flex-col min-h-screen bg-stone-50 dark:bg-stone-950 text-stone-900 dark:text-stone-100 antialiased ${isHome ? 'h-screen overflow-hidden' : ''}`}>
    
    {/* 核心修复：只传递 lang，绝对不传 t 函数 */}
    <Navbar client:load lang={lang} />
    
    <main class={`flex-grow w-full ${isHome ? 'h-full p-0' : 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 md:pt-32 pb-16'}`}>
      <slot />
    </main>

    {!isHome && (
      <footer class="mt-auto py-8 md:py-12 border-t border-stone-200 dark:border-stone-800 bg-white/50 dark:bg-stone-900/50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 text-center">
          <p class="text-stone-400 text-xs">
            {t('footer.copyright')}
          </p>
        </div>
      </footer>
    )}
  </body>
</html>
